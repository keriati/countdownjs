<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

<div id="counter">
    <span class="h"></span> :
    <span class="m"></span> :
    <span class="s"></span>
    <span class="ms"></span>
</div>

<div class="control">
    <button data-action="start">Start</button>
    <button data-action="pause">Pause</button>
    <button data-action="stop">Stop</button>
</div>

<script type="text/javascript" src="vendor/jquery-1.9.1.js"></script>

<script type="text/javascript">
    (function() {

        var defaults = {
            lengthInSeconds : 15 * 60 * 60 + 30 * 60 + 10
        };

        var CountDown = function(_options) {
            var options = $.extend({}, defaults, _options);

            this.startTime = 0;

            this.setTimeLength(options.lengthInSeconds);

            this.isPaused = false;

            this.timeLeft = {
                hours: "00",
                minutes: "00",
                seconds: "00",
                milliseconds: "000"
            };
        };

        CountDown.prototype = {
            start: function() {
                var that = this;

                this.startTime = Date.now();
                requestAnimationFrame(function() {that._tic();});

                return this;
            },

            pause: function() {
                this.isPaused = ! this.isPaused;
                return this;
            },

            stop: function() {
                return this;
            },

            reset: function() {
                return this;
            },

            setTimeLength: function(seconds) {
                console.log(seconds);
                this.lengthInSeconds = seconds;
                this.lengthInMs = seconds * 1000;
            },

            _tic: function() {
                var that = this,
                    now,
                    timeLeftInMs;

                if(!this.isPaused) {
                    now = Date.now();
                    timeLeftInMs = this.lengthInMs - (now - this.startTime);

                    this.timeLeft.hours        = Math.floor(timeLeftInMs / (1000 * 60 * 60));
                    this.timeLeft.minutes      = Math.floor((timeLeftInMs / (1000 * 60)) - (this.timeLeft.hours * 60));
                    this.timeLeft.seconds      = Math.floor((timeLeftInMs / 1000) - (this.timeLeft.hours * 60 * 60) - (this.timeLeft.minutes * 60));
                    this.timeLeft.milliseconds = Math.floor(timeLeftInMs - (this.timeLeft.hours * 60 * 60 * 1000) - (this.timeLeft.minutes * 60 * 1000) - (this.timeLeft.seconds * 1000));
                }

                that._render();
                requestAnimationFrame(function() {that._tic();});
            },

            _render: function() {
                if(this.isPaused) {
                    this._renderPaused();
                } else {
                    this._renderTime();
                }
            },

            _renderPaused: function() {

            },

            _renderTime: function() {
                $('.h').html(Math.round(this.timeLeft.hours));
                $('.m').html(Math.round(this.timeLeft.minutes));
                $('.s').html(Math.round(this.timeLeft.seconds));
                $('.ms').html(Math.round(this.timeLeft.milliseconds));
            }
        };


        var myCountDown = new CountDown();
//        myCountDown.start();

        $('.control button').click(function() {
            var action = $(this).data('action');

            myCountDown[action]();
        })
    })();
</script>

</body>
</html>